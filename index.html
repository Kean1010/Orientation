<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Orientation Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body { font-family: 'Arial', sans-serif; }
        #puzzleFeedback { color: red; }
        .clue { display: none; }
        .clue.active { display: block; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold mb-4 text-center">Orientation Adventure</h1>

        <!-- Google Sign-In and Upload Section -->
        <section class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Upload Media to Google Drive</h2>
            <button id="signInButton" onclick="handleAuthClick()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mb-2">Sign in with Google</button>
            <input type="file" id="mediaInput" accept="image/*,video/*" class="mb-2 hidden">
            <button id="uploadButton" onclick="uploadMedia()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 hidden">Upload</button>
            <p id="uploadStatus" class="mt-2"></p>
        </section>

        <!-- Puzzle Section -->
        <section class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Solve the Puzzle</h2>
            <p>Riddle: I speak without a mouth and hear without ears. I have no body, but I come alive with the wind. What am I?</p>
            <input type="text" id="puzzleAnswer" placeholder="Enter your answer" class="border p-2 w-full mb-2">
            <button onclick="checkPuzzle()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Submit</button>
            <p id="puzzleFeedback"></p>
        </section>

        <!-- Clues Section -->
        <section>
            <h2 class="text-xl font-semibold mb-2">Clues</h2>
            <div id="clues">
                <p class="clue" data-id="1">Clue 1: Check the campus map for hidden symbols.</p>
                <p class="clue" data-id="2">Clue 2: The library holds a secret in the old books section.</p>
                <p class="clue" data-id="3">Clue 3: Look near the fountain at noon.</p>
            </div>
            <button onclick="showNextClue()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mt-2">Next Clue</button>
        </section>
    </div>

    <script>
        // Google Drive API Configuration
        const CLIENT_ID = '850400021008-bvtepiok8fgsl68r5s6d8b92ui46euqr.apps.googleusercontent.com
'; // Replace with your OAuth 2.0 Client ID
        const API_KEY = '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'; // Replace with your API Key
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        let tokenClient = null;
        let accessToken = null;

        // Initialize Google API Client
        function initClient() {
            console.log('Initializing Google API Client...');
            if (!window.gapi) {
                document.getElementById('uploadStatus').textContent = 'Google API script failed to load. Please check your network.';
                console.error('gapi not loaded');
                return;
            }
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                }).then(() => {
                    console.log('Google API Client initialized');
                    // Check if Google Identity Services is loaded
                    if (!window.google || !window.google.accounts || !window.google.accounts.oauth2) {
                        document.getElementById('uploadStatus').textContent = 'Google Identity Services not loaded. Please try again later.';
                        console.error('Google Identity Services not available');
                        return;
                    }
                    // Initialize tokenClient
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: (response) => {
                            if (response.error) {
                                document.getElementById('uploadStatus').textContent = `Authentication failed: ${response.error}. Please check console.`;
                                console.error('Auth error:', response);
                                return;
                            }
                            accessToken = response.access_token;
                            document.getElementById('signInButton').classList.add('hidden');
                            document.getElementById('mediaInput').classList.remove('hidden');
                            document.getElementById('uploadButton').classList.remove('hidden');
                            document.getElementById('uploadStatus').textContent = 'Signed in. Ready to upload!';
                            console.log('Authentication successful, access token received');
                        },
                    });
                    console.log('tokenClient initialized:', tokenClient);
                }).catch(error => {
                    document.getElementById('uploadStatus').textContent = `API initialization failed: ${error.message}. Check Client ID and origins.`;
                    console.error('API init error:', error);
                });
            });
        }

        // Handle Google Sign-In
        function handleAuthClick() {
            console.log('Sign-in button clicked');
            if (!tokenClient) {
                document.getElementById('uploadStatus').textContent = 'Google API not initialized. Please refresh the page or check console.';
                console.error('Token client not initialized');
                return;
            }
            tokenClient.requestAccessToken();
        }

        // Upload Media to Google Drive
        async function uploadMedia() {
            console.log('Upload button clicked');
            const fileInput = document.getElementById('mediaInput');
            const file = fileInput.files[0];
            const status = document.getElementById('uploadStatus');
            if (!file) {
                status.textContent = 'Please select a file.';
                console.error('No file selected');
                return;
            }
            if (!accessToken) {
                status.textContent = 'Please sign in with Google.';
                console.error('No access token');
                return;
            }

            const metadata = {
                name: file.name,
                mimeType: file.type,
                parents: ['https://drive.google.com/drive/u/1/folders/1NL52QY-oyuWgG1_ab7nrYwqwIrDMBiMF'], // Replace with your Google Drive folder ID
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);

            try {
                console.log('Uploading file:', file.name);
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: form,
                });
                if (response.ok) {
                    status.textContent = 'Upload successful!';
                    console.log('Upload successful');
                } else {
                    const errorData = await response.json();
                    status.textContent = `Upload failed: ${errorData.error.message}`;
                    console.error('Upload error:', errorData);
                }
            } catch (error) {
                status.textContent = `Upload failed: ${error.message}`;
                console.error('Upload error:', error);
            }
        }

        // Puzzle Logic
        function checkPuzzle() {
            const answer = document.getElementById('puzzleAnswer').value.trim().toLowerCase();
            const correctAnswer = 'echo';
            const feedback = document.getElementById('puzzleFeedback');
            if (answer === correctAnswer) {
                feedback.textContent = 'Correct! You solved the riddle!';
                feedback.style.color = 'green';
                showNextClue();
            } else {
                feedback.textContent = 'Incorrect. Try again!';
            }
        }

        // Clue Logic
        let currentClue = 0;
        function showNextClue() {
            const clues = document.querySelectorAll('.clue');
            if (currentClue < clues.length) {
                clues[currentClue].classList.add('active');
                currentClue++;
            } else {
                alert('No more clues available!');
            }
        }

        // Initialize Google API Client on page load
        window.onload = () => {
            console.log('Page loaded, initializing client');
            initClient();
        };
    </script>
</body>
</html>
